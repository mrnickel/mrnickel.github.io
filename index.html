
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>RyanNickel.com</title>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/markdown.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/icons.css">

    <link rel="stylesheet" href="/css/styles.css">
    <!-- <script src="/js/site.js"> -->
  </head>
  <body>
  <div id="wrapper">
  	<div class="jumbotron" id="header">
  	  <h1 class="text-center">Hello, my name is Ryan Nickel</h1>
  	  <p class="text-center">And I am a developer. This is where I post my thought poops.</p>
  	</div>

  	<div class="container">
  		<div class="row">
  			<div class="col-md-8 col-md-offset-2">

	  			<article>
				<h1><a href="/html/my_first_go_project.html">My first go project</a></h1>
	  				<p>It&rsquo;s no secret that I&rsquo;m currently enamoured with <a href="https://golang.org">Go</a>, as well as the projects it powers. (<a href="https://www.docker.com">Docker</a> I&rsquo;m looking at you). As such I recently started my first project with the lovely &ldquo;new&rdquo; language.</p>

<p>I thought I would get my feet wet by creating yet another <a href="https://github.com/mrnickel/StaticSiteGenerator">static site generator</a>. The very generator I use to build this site (because dogfooding is important!).</p>

<p>This post is primarily about getting myself acquainted with Go and writing my first little Go app.</p>

<p>Now, I come from a world of Java and (modern) PHP. A world where namespaces and packages abound - a world of classes. So as you can imagine, this transition made the leap to Go a little bit of a challenge. Don’t get me wrong, Go does have these attributes as well, but that&rsquo;s not what it stresses.</p>

<p>Instead, Go emphasizes simplicity.</p>

<p>As a proponent of simplicity, I decided to dive in head first!</p>

<p>I read over the documentation and got to work.</p>

<p>My <a href="https://github.com/mrnickel/StaticSiteGenerator/tree/0dca8507eed53acd1ca1bd8e92139678f79f7441">first version</a> of the app utilized four different packages (not including main):</p>

<ul>
<li><a href="https://github.com/mrnickel/StaticSiteGenerator/tree/0dca8507eed53acd1ca1bd8e92139678f79f7441/constants">constants</a></li>
<li><a href="https://github.com/mrnickel/StaticSiteGenerator/tree/0dca8507eed53acd1ca1bd8e92139678f79f7441/post">post</a></li>
<li><a href="https://github.com/mrnickel/StaticSiteGenerator/tree/0dca8507eed53acd1ca1bd8e92139678f79f7441/publish">publish</a></li>
<li><a href="https://github.com/mrnickel/StaticSiteGenerator/tree/0dca8507eed53acd1ca1bd8e92139678f79f7441/stats">stats</a></li>
</ul>

<p>It worked, but that wasn&rsquo;t my primary goal. The ultimate goal was to educate myself with Go - to learn the right way to do things. From my past experience, in order to know how to do something correctly, you have to do a few wrongs things first.</p>

<p>Now that the project was functional, it was time to take a step back and review.</p>

<p>I sought feedback from the <a href="https://www.reddit.com/r/golang">golang subreddit</a>, and a few people were kind enough to give me some pointers.</p>

<h2>My first mistake: Too Many Packages</h2>

<p>It became apparent that my head was very much in the Java world. &ldquo;Namespace and package all the things&rdquo;, my brain thought.</p>

<p>As outlined by Andrew Gerrand in Google&rsquo;s official Go blog <a href="http://blog.golang.org/organizing-go-code">Organizing Go Code</a>, this is a big no-no:</p>

<blockquote>
<p>On the other hand, it is also easy to go overboard in splitting your code into small packages, in which case you will likely become bogged down in interface design, rather than just getting the job done.</p>
</blockquote>

<p>This was me to a T. I had spent far too much time trying to &ldquo;design&rdquo; the interfaces than getting the job done (the job being to learn idiomatic Go).</p>

<p>My main concern was that I would pollute my other packages with private functions that had no business being there. However upon further analysis, I found this would be true with any sort of application.</p>

<p>The solution isn&rsquo;t packages, it&rsquo;s properly writing code (duh!)</p>

<h2>My second mistake: Too Complicated</h2>

<p>With too many packages comes increased dependencies and therefore a web of complexities. This is counter to what Go stresses (simplicity!).
Peter Bourgon&rsquo;s post about <a href="http://peter.bourgon.org/go-in-production/">Go: Best Practices for Production Enviornments</a>, is a great read. I especially liked his section on <a href="http://peter.bourgon.org/go-in-production/#repository-structure">Repository Structure</a>:</p>

<blockquote>
<p>Our best practice is to keep things simple.</p>
</blockquote>

<p>That really struck a chord with me.</p>

<p>This line even more so:</p>

<blockquote>
<p>Don’t create structure until you demonstrably need it.</p>
</blockquote>

<p>&ldquo;If it&rsquo;s good enough for SoundCloud&rdquo;, I thought, &ldquo;it&rsquo;s good enough for me!&rdquo; *1. So off I went, on a quest to simplify my application. My end result now has no packages (aside from main), and 3 files. It really doesn&rsquo;t get more straightforward than that.</p>

<p>It wasn&rsquo;t as easy as simply removing packages and tossing everything inside of the root directory. I had my reservations! Primarily, my need to keep the number of lines of code in a file as low as logically possible.</p>

<p>I typically try to keep the number of lines in a file as small as I can. To me, files with a large number of lines in it is a code smell. Obviously you should be able to refactor that, no? Well in Go that isn&rsquo;t necessarily the case. Go seems to lean towards writing code that revolves around adding functionality to structs; this rule isn&rsquo;t quite as set in stone.</p>

<p>The Go sources <a href="https://golang.org/src/net/http/request.go">burst</a> <a href="https://golang.org/src/net/http/server.go">with</a> <a href="https://golang.org/src/net/http/transfer.go">files</a> <a href="https://golang.org/src/net/http/transport.go">having</a> <a href="https://golang.org/src/time/format.go">large</a> <a href="https://golang.org/src/time/time.go">lines of code</a>. It&rsquo;s definitely going to be some time before I get a feel for things, but I&rsquo;m quite comfortable with the size of the post struct (the obvious workhorse for a project such as this).</p>

<p>There&rsquo;s only so much that one can learn in a small project, but schooling oneself is never the less the objective of this project. There&rsquo;s obviously much more I have left to grasp, but that&rsquo;s one of the best things about being a student of programming and life.</p>

<p>There&rsquo;s always more to learn; then perhaps if I’m fortunate, master.</p>

<p>If you have any feedback for me or want to chat further, hit me up on twitter <a href="https://twitter.com/rnickel">@rnickel</a></p>

<p>*1. This is a tidbit I plan on implementing in all my projects going forward, regardless of which language it&rsquo;s written in.</p>

		            <p class="published-date">Feb 18, 2016</p>
	  			</article>

	  			<article>
				<h1><a href="/html/logging_with_docker_and_loggly.html">Logging with Docker and Loggly</a></h1>
	  				<p>In part 2 of this series, I&rsquo;m going to explore using Loggly to aggregate my Docker container logs.</p>

<p>Now I&rsquo;m partial to taking the path to least resistance, and as such I&rsquo;m going to follow Loggly&rsquo;s own documentation on using the <a href="https://www.loggly.com/docs/docker-logging-driver/">Docker Logging Driver</a>.</p>

<p>From what I understand about using Docker on a Mac, the docker-machine would be where I would have to SSH into in order to perform step 1 (Configure Syslog Daemon).</p>

<p>SSH&rsquo;ing into my default docker-machine via <code>docker-machine ssh default</code> and attempting to execute <code>sudo bash configure-linux.sh -a SUBDOMAIN -u USERNAME</code> leaves me with an error informing me: <code>bash: command not found</code>. Okay, let&rsquo;s install bash then.</p>

<p>The default docker machine flavour of linux on mac is <a href="http://www.tinycorelinux.net">Tiny Core Linux</a>, so we can use their <code>tcl</code> command to bring up their package installer.</p>

<pre><code>$ tce
$ s // to search
$ bash // to search for bash
$ 2 // to install bash.tcz
$ i // to confirm installation
</code></pre>

<p>Now that bash is installed, let&rsquo;s try to execute the configuration script again:</p>

<pre><code>sudo bash configure-linux.sh -a SUBDOMAIN -u USERNAME
</code></pre>

<p>And we get&hellip;</p>

<pre><code>Loggly account or subdomain: XXX
Username is set
Please enter Loggly Password:
</code></pre>

<p>Great! It&rsquo;s asking me for more. Enter the password and&hellip;.</p>

<pre><code>INFO: Initiating Configure Loggly for Linux.
configure-linux.sh: line 626: base64: command not found
configure-linux.sh: line 626: echo: write error: Broken pipe
ERROR: Base64 decode is not supported on your Operating System. Please update your system to support Base64.
</code></pre>

<p>Well that&rsquo;s no good. After searching for WAY to long on how to install base64 on TCL I came up empty.</p>

<p>Unfortunately it seems as though the Docker Logging Driver for Loggly just isn&rsquo;t an option for me.</p>

<p>Next up I&rsquo;ll try to <a href="https://www.loggly.com/docs/rsyslog-manual-configuration/">manually configure rsyslog</a> instead of using the setup script.</p>

		            <p class="published-date">Feb 05, 2016</p>
	  			</article>

	  			<article>
				<h1><a href="/html/logging_with_docker.html">Logging with Docker</a></h1>
	  				<p>As of late I&rsquo;ve been trying to learn <a href="https://www.docker.com">Docker</a>. I&rsquo;ve been using Ansible / Vagrant for quite some time now with great success. The only problem I have with the combination is that it takes up quite a bit of system resources to run each instance. The idea of running a single VM and individual containers for each service really speaks to me.</p>

<p>As such I&rsquo;ve been trying to move one of our smaller services over to running in a container. This service is a standalone Java application that runs all of the time and manages sending push notifications to all users.</p>

<p>I&rsquo;ve created a small Java app to play with for this post over on <a href="https://github.com/mrnickel/DockerLogLearning">GitHub</a>.</p>

<p>According to the holy rules passed down to us by <a href="https://www.heroku.com">Heroku</a> in the form of writing <a href="http://12factor.net">12 Factor Apps</a>, <a href="http://12factor.net/logs">Thou must treat logs as event streams</a>. Essentially what this means is that all logs need to be out via STDOUT, (I also use STDERR). Nice and easy to deal with when developping the apps, and ultimiately I agree that the application shouldn&rsquo;t worry itself with where logs should be output. I also appreciate that, as a developer, it puts any errors or info messages directly in my face as I&rsquo;m working on them.</p>

<p>As you can see in my <a href="https://github.com/mrnickel/DockerLogLearning/blob/master/src/main/resources/log4j2.xml">log4j2.xml</a> config file, I do just that.</p>

<p>Building and running the docker container will reveal the wealth of data that I am generating to the world.</p>

<pre><code>testproj 2016-01-17T17:19:18,680 INFO Timer-0 HelloWorld.run - Timer task started at:Sun Jan 17 17:19:18 UTC 2016
testproj 2016-01-17T17:19:18,678 INFO main HelloWorld.main - TimerTask started
testproj 2016-01-17T17:19:20,683 INFO Timer-0 HelloWorld.run - Timer task finished at:Sun Jan 17 17:19:20 UTC 2016
testproj 2016-01-17T17:19:20,684 ERROR Timer-0 HelloWorld.run - This is an error message...
java.lang.Exception: This is my exception, dawg
	at com.RyanNickel.TestDockerProj.App.run(App.java:16) [TestDockerProj.jar:?]
	at java.util.TimerThread.mainLoop(Timer.java:555) [?:1.8.0_66-internal]
	at java.util.TimerThread.run(Timer.java:505) [?:1.8.0_66-internal]
testproj 2016-01-17T17:19:28,675 INFO Timer-0 HelloWorld.run - Timer task started at:Sun Jan 17 17:19:28 UTC 2016
testproj 2016-01-17T17:19:28,683 INFO main HelloWorld.main - TimerTask cancelled
testproj 2016-01-17T17:19:30,677 INFO Timer-0 HelloWorld.run - Timer task finished at:Sun Jan 17 17:19:30 UTC 2016
testproj 2016-01-17T17:19:30,677 ERROR Timer-0 HelloWorld.run - This is an error message...
java.lang.Exception: This is my exception, dawg
	at com.RyanNickel.TestDockerProj.App.run(App.java:16) [TestDockerProj.jar:?]
	at java.util.TimerThread.mainLoop(Timer.java:555) [?:1.8.0_66-internal]
	at java.util.TimerThread.run(Timer.java:505) [?:1.8.0_66-internal]
</code></pre>

<p>As you can see I have 2 types of messages. INFO messages, and ERROR stack traces. Both crucial types of information that one would see in their own production apps.</p>

<p>Great place to start. Obviously I don&rsquo;t want to be looking at each container individually, especailly as our service scales and we are running multiple instances of this container. It&rsquo;s just not a very efficient way to track down issues. Enter log aggregators!</p>

<p>As far as I know, there are 3 main players in the log aggregation space:</p>

<ol>
<li><a href="https://aws.amazon.com/cloudwatch/">AWS Cloud Watch</a></li>
<li><a href="https://www.loggly.com">Loggly</a></li>
<li>[papertrail]](<a href="https://papertrailapp.com">https://papertrailapp.com</a>)</li>
</ol>

<p>It seemed to me as though the log drivers were the easiest way to go about this. Start the container with a log driver specified, and call it a day, right? They even offer an AWS CloudWatch driver. Awesome! Let&rsquo;s try to implement that shall we!</p>

<p>Now, I&rsquo;m running a mac locally and prefer to have everything working on my own instances before popping them up to a more permanent location. So first step!</p>

<blockquote>
<p>configure the default logging driver by passing the &ndash;log-driver option to the Docker daemon:
<code>docker daemon --log-driver=awslogs</code></p>
</blockquote>

<p>Wait&hellip; what? I can&rsquo;t do that on mac installation&hellip; the docker docs leave much to be desired here.</p>

<p>The easiest way that I&rsquo;ve found to start playing with this logger is to create a new docker-machine with the appropriate log driver and enviornment variables set. Run the following command to create a new <em>awslogging</em> machine:</p>

<pre><code>docker-machine create -d virtualbox \
 --engine-opt log-driver=awslogs \
 --engine-env AWS_ACCESS_KEY_ID=XXX \
 --engine-env AWS_SECRET_ACCESS_KEY=XXX \ 
 awslogging
</code></pre>

<p>Make sure that you enter your AWS creds in the above snippet.</p>

<p>Once the machine has been created you must use it via:</p>

<pre><code>docker-machine start awslogging
eval $(docker-machine env awslogging)
</code></pre>

<p>Now we can build our container image</p>

<pre><code>docker build -t test-docker-proj .
</code></pre>

<p>And finally we can run the container via:</p>

<pre><code>docker run --log-driver=awslogs \
 --log-opt awslogs-region=us-west-2 \
 --log-opt awslogs-group=myLogGroup \
 --log-opt awslogs-stream=myContainerStream 
 test-docker-proj
</code></pre>

<p>Again, ensure that you change the aws-logs* log options to match your AWS setting.</p>

<p>Great! Now we&rsquo;re getting logs pushed up to CloudWatch Yay!</p>

<p><img src="/images/aws_cloudwatch_event_stream.png" alt="AWS CloudWatch event stream" /></p>

<p>So we&rsquo;re getting logs, the only problem is how they&rsquo;re stored. Each line of output is it&rsquo;s own Event. Well that&rsquo;s no good for our ERROR stack traces. That should be recongized as being a single event.</p>

<p>Now I know that it&rsquo;s possible using Amazon&rsquo;s official <a href="https://s3.amazonaws.com/aws-cloudwatch/downloads/latest/awslogs-agent-setup.py">log agent</a> to set some configuration options. The one I&rsquo;m after is the <em>Timestamp format</em>. There don&rsquo;t seem to be any options that the docker logging driver offers to allow me to specify anything outside of the region, group and stream. Even taking a peek at the <a href="https://github.com/docker/docker/blob/master/daemon/logger/awslogs/cloudwatchlogs.go">source file</a> led me to believe that there was nothing I could do.</p>

<p>So it looks as though the awslogs driver is a pretty basic implementation.</p>

<p>With the next blog post we&rsquo;ll look into popping logs up into Loggly and papertrail app to see if they offer anything a little more robust.</p>

		            <p class="published-date">Jan 18, 2016</p>
	  			</article>

	  			<article>
				<h1><a href="/html/hello_world.html">Hello world</a></h1>
	  				<p>Welcome to my personal site. Here I will be posting my &ldquo;thought poops&rdquo;. It&rsquo;s mostly musings about development and design related stuff&hellip; I think. I likely won&rsquo;t be writing too much. The site is more of a place for me to experiment.</p>

		            <p class="published-date">Jan 04, 2016</p>
	  			</article>

  			</div>
  		</div>
  	</div>
  </div>

	<div class="footer container">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 socials">
					<p>
						<a href="https://twitter.com/rnickel">Twitter</a> &#x26AC <a href="https://github.com/mrnickel">GitHub</a> &#x26AC <a href="/about.html">About</a> &#x26AC <a href="/rss.xml">RSS</a>
					</p>
					<p>Made with &hearts; in Toronto, Canada</p>
					<img src="/img/toronto-icon-sm.png" height="70px" />
					<p>Generated with my super awesome <a href="https://github.com/mrnickel/StaticSiteGenerator">StaticSiteGenerator</a></p>
				</div>
			</div>
		</div>
	</div>

  </body>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35684132-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
